version: '3.8'

services:
  # Сервис бэкенда (агент)
  agent:
    build:
      context: ./
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - TAVILY_API_KEY=${TAVILY_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL}
      - NANO_MODEL=${NANO_MODEL}
      - KIMIK2_MODEL=${KIMIK2_MODEL}
      - MODEL_TYPE=${MODEL_TYPE:-openai}
    env_file:
      - ./.env
    networks:
      - app-network

  # Сервис фронтенда
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "80:80"
    environment:
      - API_URL=http://agent:8000
    depends_on:
      - agent
    networks:
      - app-network

# Определение сети для взаимодействия сервисов
networks:
  app-network:
    driver: bridge